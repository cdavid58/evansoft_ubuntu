{% load static %}
<!DOCTYPE html>
<html>
<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>Evansoft App</title>
	<link rel="apple-touch-icon" sizes="180x180" href="{% static 'vendors/images/apple-touch-icon.png' %}">
	<link rel="icon" type="image/png" sizes="32x32" href="{% static 'vendors/images/favicon-32x32.png' %}">
	<link rel="icon" type="image/png" sizes="16x16" href="{% static 'vendors/images/favicon-16x16.png' %}">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/core.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/icon-font.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'src/plugins/datatables/css/dataTables.bootstrap4.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'src/plugins/datatables/css/responsive.bootstrap4.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'src/plugins/dropzone/src/dropzone.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/style.css' %}">

	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<link rel="manifest" href="{% static 'manifest.json' %}">
	<link rel="stylesheet" href="{% static 'evangeli/evangeli.css' %}">
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-119386393-1');
	</script>
	<style>
		input[type=number]::-webkit-inner-spin-button, 
		input[type=number]::-webkit-outer-spin-button { 
		  -webkit-appearance: none; 
		  margin: 0; 
		}
		input[type=number] { -moz-appearance:textfield; }

		/* Spinner centrado */
		.spinner {
			width: 80px;
			height: 80px;
			border: 8px solid rgba(0, 0, 0, 0.1); /* Bordes suaves */
			border-top-color: #3498db; /* Color principal del borde superior */
			border-radius: 50%; /* Hace que el div sea circular */
			animation: spin 1s linear infinite; /* Animación de giro infinita */
			overflow: hidden;
		}

		/* Animación de giro */
		@keyframes spin {
			0% {
			  transform: rotate(0deg);
			}
			100% {
			  transform: rotate(360deg);
			}
		}

		/* Estilos adicionales */
		.modal-body p {
			font-size: 18px;
			color: #333;
			overflow: hidden;
		}
	</style>
	<!-- 32244 -->
</head>
<body>
	<!-- <div class="pre-loader">
		<div class="pre-loader-box">
			<div class="loader-logo"><img src="{% static 'vendors/images/deskapp-logo.svg' %}" alt=""></div>
			<div class='loader-progress' id="progress_div">
				<div class='bar' id='bar1'></div>
			</div>
			<div class='percent' id='percent1'>0%</div>
			<div class="loading-text">
				Loading...
			</div>
		</div>
	</div> -->

	<div class="header">
		<div class="header-left">
			<div class="menu-icon dw dw-menu"></div>
			<div class="search-toggle-icon dw dw-search2" data-toggle="header_search"></div>
			<div class="header-search">
				<!-- <form>
					<div class="form-group mb-0">
						<i class="dw dw-search2 search-icon"></i>
						<input type="text" class="form-control search-input" placeholder="Search Here">
						<div class="dropdown">
							<a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown">
								<i class="ion-arrow-down-c"></i>
							</a>
							<div class="dropdown-menu dropdown-menu-right">
								<div class="form-group row">
									<label class="col-sm-12 col-md-2 col-form-label">From</label>
									<div class="col-sm-12 col-md-10">
										<input class="form-control form-control-sm form-control-line" type="text">
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-12 col-md-2 col-form-label">To</label>
									<div class="col-sm-12 col-md-10">
										<input class="form-control form-control-sm form-control-line" type="text">
									</div>
								</div>
								<div class="form-group row">
									<label class="col-sm-12 col-md-2 col-form-label">Subject</label>
									<div class="col-sm-12 col-md-10">
										<input class="form-control form-control-sm form-control-line" type="text">
									</div>
								</div>
								<div class="text-right">
									<button class="btn btn-primary">Search</button>
								</div>
							</div>
						</div>
					</div>
				</form> -->
			</div>
		</div>
		<div class="header-right">
			<div class="user-notification">
				<div class="dropdown">
					<!-- <a class="dropdown-toggle no-arrow" href="#" role="button" data-toggle="dropdown">
						<i class="icon-copy dw dw-notification"></i>
						<span class="badge notification-active"></span>
					</a> -->
					<!-- <div class="dropdown-menu dropdown-menu-right">
						<div class="notification-list mx-h-350 customscroll">
							<ul>
								<li>
									<a href="javascript:void(0);">
										<img src="{% static 'vendors/images/img.jpg' %}" alt="">
										<h3>{{request.session.name_employee}}</h3>
										<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed...</p>
									</a>
								</li>
							</ul>
						</div>
					</div> -->
				</div>
			</div>
			<div class="user-info-dropdown">
				<div class="dropdown">
					<a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
						<span class="user-icon">
							<img src="{{request.session.logo}}" style="width: 100% !important; height: 100% !important;" alt="">
						</span>
						<span class="user-name">{{request.session.name_employee}}</span>
					</a>
					<div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
						{% if not request.session.create_box %}
							<a class="dropdown-item" href="{% url 'OutLogin' %}"><i class="dw dw-logout"></i>Salir</a>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="left-side-bar">
		<div class="brand-logo">
			<a href="{% url 'Index' %}">
				<img src="{% static 'vendors/images/deskapp-logo.svg' %}" alt="" class="dark-logo">
				<img src="{% static 'vendors/images/deskapp-logo-white.svg' %}" alt="" class="light-logo">
			</a>
			<div class="close-sidebar" data-toggle="left-sidebar-close">
				<i class="ion-close-round"></i>
			</div>
		</div>
		<div class="menu-block customscroll">
			<div class="sidebar-menu">
				<ul id="accordion-menu">
					<li>
						<a href="{% url 'Index' %}" class="dropdown-toggle no-arrow">
							<span class="micon dw dw-house-1"></span><span class="mtext">Home</span>
						</a>
					</li>
					{% if request.session.rols == 'Todos' or request.session.rols == 'Facturador' %}
						<li class="dropdown">
							<a href="javascript:void(0);" class="dropdown-toggle">
								<span class="micon dw dw-apartment"></span><span class="mtext">Crear Documentos</span>
							</a>
							<ul class="submenu">
								<li>
									<a href="{% url 'Create_Invoice' 1 %}">Factura</a>
								</li>
								<li>
									<a href="javascript:void(0);" onclick="alert('Aun estamos trabajando en ello');">Nomina</a>
								</li>
								<li>
									<a href="javascript:void(0);" onclick="alert('Aun estamos trabajando en ello');">Cotización</a>
								</li>
								<li>
									<a href="javascript:void(0);" onclick="alert('Aun estamos trabajando en ello');">Documento Soporte</a>
								</li>
								<li>
									<a href="{% url 'Create_Novelty' %}">Novedad</a>
								</li>
							</ul>
						</li>
						</li>
						<li class="dropdown">
							<a href="javascript:void(0);" class="dropdown-toggle">
								<span class="micon dw dw-invoice"></span><span class="mtext">Documentos Generados</span>
							</a>
							<ul class="submenu">
								<li><a href="{% url 'List_Invoice' 1 %}">Facturas</a></li>
								<li><a href="{% url 'List_Invoice' 99 %}">Remisión</a></li>
							</ul>
						</li>
						<li>
							<a href="{% url 'List_Customer' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-user1"></span><span class="mtext">Clientes</span>
							</a>
						</li>
						{% if request.session.create_box %}
							<li>
								<a href="javascript:void(0);" class="dropdown-toggle no-arrow close_box">
									<span class="micon dw dw-invoice"></span><span class="mtext">Cierre de Caja</span>
								</a>
							</li>
						{% endif %}
					{% endif %}
					{% if request.session.rols == 'Todos' or request.session.rols == 'Administativo' %}
						<li>
							<a href="{% url 'List_Inventory' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-shop"></span><span class="mtext">Inventario</span>
							</a>
						</li>
						<li>
							<a href="{% url 'List_Employee' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-user1"></span><span class="mtext">Empleados</span>
							</a>
						</li>
						
						<li>
							<a href="{% url 'Evangeli' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-worldwide"></span><span class="mtext">Evangeli</span>
							</a>
						</li>
						<li>
							<a href="{% url 'Get_All_accounts_Receivable_View' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-wallet-1"></span><span class="mtext">Cartera</span>
							</a>
						</li>
						<li>
							<a href="{% url 'List_Customer' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-cursor-2"></span><span class="mtext">Correo Electrónico</span>
							</a>
						</li>
						<li>
							<a href="{% url 'List_Supplier' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-user1"></span><span class="mtext">Proveedores</span>
							</a>
						</li>
						<li>
							<a href="{% url 'Create_Shopping' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-shop"></span><span class="mtext">Compras</span>
							</a>
						</li>
					{% endif %}
					{% if request.session.rols == 'Todos' or request.session.rols == 'Administativo' or request.session.rols == 'Contador' %}
					<li class="dropdown">
						<a href="javascript:void(0);" class="dropdown-toggle">
							<span class="micon dw dw-invoice"></span><span class="mtext">Reportes</span>
						</a>
						<ul class="submenu">
							<li class="dropdown">
								<a href="javascript:;" class="dropdown-toggle">
									<span class="micon fa fa-file-text"></span><span class="mtext">Facturas</span>
								</a>
								<ul class="submenu child">
									<li><a href="javascript:void(0);" class="export_sales_report">Exportar Ventas por IVA</a></li>
									<li><a href="javascript:void(0);" class="generate_closure_report_by_date">Reporte de venta</a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="javascript:;" class="dropdown-toggle">
									<span class="micon fa fa-file-text"></span><span class="mtext">Contabilidad</span>
								</a>
								<ul class="submenu child">
									<li><a href="javascript:void(0);" class="generate_journal_report">Asientos Contables Completo</a></li>
								</ul>
							</li>
							{% if request.session.rols == 'Todos' or request.session.rols == 'Administativo' %}
								<li class="dropdown">
									<a href="javascript:;" class="dropdown-toggle">
										<span class="micon fa fa-shopping-cart"></span><span class="mtext">Inventario</span>
									</a>
									<ul class="submenu child">
										<li><a href="javascript:void(0);" class="Get_Profit_Report_Excel">Informe de ganancias</a></li>
										<li><a href="{% url 'View_Sales_Product' %}">Mas vendidos</a></li>
										<li><a class="history_mov" href="javascript:void(0);">Historial de movimientos</a></li>
									</ul>
								</li>
							{% endif %}
						</ul>
					</li>
					{% endif %}
					
					{% if request.session.rols == 'Todos' %}
						<li>
							<div class="dropdown-divider"></div>
						</li>
						<li class="dropdown">
							<a href="javascript:void(0);" class="dropdown-toggle">
								<span class="micon dw dw-settings2"></span><span class="mtext">Configuración</span>
							</a>
							<ul class="submenu">
								<li><a href="{% url 'Setting_Company' %}">Compañia</a></li>
								<li><a href="{% url 'List_Branch' %}">Sucursales</a></li>
							</ul>
						</li>
						<!-- <li>
							<div class="dropdown-divider"></div>
						</li>
						<li>
							<a href="{% url 'Pricing' %}" class="dropdown-toggle no-arrow">
								<span class="micon dw dw-box"></span><span class="mtext">Planes</span>
							</a>
						</li> -->
					{% endif %}
				</ul>
				<div class="d-none d-md-block" style="height: 50px;"></div>
			</div>
		</div>
	</div>
	<div class="mobile-menu-overlay"></div>

	<div class="main-container">
		<div class="pd-ltr-20 xs-pd-20-10">
			<div class="min-height-200px">
				<div class="page-header">
					{% block content %}
					{% endblock %}
				</div>
			</div>
			<div class="footer-wrap pd-20 mb-20 card-box">
				DeskApp - Developed By Evansoft</a>
			</div>
		</div>
	</div>



	<!-- START MODALS -->

		<a href="javascript:void(0);" class="btn-block export_sales_report_modal" hidden data-toggle="modal" data-target="#Export_Sales_Report" type="button">Modal</a>
		<div class="modal fade" id="Export_Sales_Report" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myLargeModalLabel">Seleccione fecha inicial y final</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="fecha-inicial" class="form-label">Fecha Inicial</label>
							<div class="input-group custom">
								<input type="date" id="fecha-inicial" class="form-control form-control-lg" placeholder="Selecciona una fecha">
								<div class="input-group-append custom">
									<span class="input-group-text">
										<i class="icon-copy dw dw-calendar"></i>
									</span>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label for="fecha-final" class="form-label">Fecha Final</label>
							<div class="input-group custom">
								<input type="date" id="fecha-final" class="form-control form-control-lg" placeholder="Selecciona una fecha">
								<div class="input-group-append custom">
									<span class="input-group-text">
										<i class="icon-copy dw dw-calendar"></i>
									</span>
								</div>
							</div>
						</div>

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary close_export_data" data-dismiss="modal">Cerrar</button>
						<button type="button" class="btn btn-primary export_data">Generar Reporte</button>
					</div>
				</div>
			</div>
		</div>



		<a href="javascript:void(0);" class="btn-block generate_journal_report_modal" hidden data-toggle="modal" data-target="#Generate_Journal_Report" type="button">Modal</a>
		<div class="modal fade" id="Generate_Journal_Report" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myLargeModalLabel">Seleccione fecha inicial y final</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="fecha-inicial_journal" class="form-label">Fecha Inicial</label>
							<div class="input-group custom">
								<input type="date" id="fecha-inicial_journal" class="form-control form-control-lg" placeholder="Selecciona una fecha">
								<div class="input-group-append custom">
									<span class="input-group-text">
										<i class="icon-copy dw dw-calendar"></i>
									</span>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label for="fecha-final_journal" class="form-label">Fecha Final</label>
							<div class="input-group custom">
								<input type="date" id="fecha-final_journal" class="form-control form-control-lg" placeholder="Selecciona una fecha">
								<div class="input-group-append custom">
									<span class="input-group-text">
										<i class="icon-copy dw dw-calendar"></i>
									</span>
								</div>
							</div>
						</div>

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary close_generate_journal_report_data" data-dismiss="modal">Cerrar</button>
						<button type="button" class="btn btn-primary generate_journal_report_data">Generar Reporte</button>
					</div>
				</div>
			</div>
		</div>

		<a href="javascript:void(0);" class="btn-block get_profit_report_excel_modal" hidden data-toggle="modal" data-target="#Get_Profit_Report_Excel" type="button">Modal</a>
		<div class="modal fade" id="Get_Profit_Report_Excel" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myLargeModalLabel">Seleccione fecha inicial y final</h4>
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="fecha-inicial_Get_Profit_Report_Excel" class="form-label">Fecha Inicial</label>
							<div class="input-group custom">
								<input type="date" id="fecha-inicial_Get_Profit_Report_Excel" class="form-control form-control-lg" placeholder="Selecciona una fecha">
								<div class="input-group-append custom">
									<span class="input-group-text">
										<i class="icon-copy dw dw-calendar"></i>
									</span>
								</div>
							</div>
						</div>
						<div class="form-group">
							<label for="fecha-final_Get_Profit_Report_Excel" class="form-label">Fecha Final</label>
							<div class="input-group custom">
								<input type="date" id="fecha-final_Get_Profit_Report_Excel" class="form-control form-control-lg" placeholder="Selecciona una fecha">
								<div class="input-group-append custom">
									<span class="input-group-text">
										<i class="icon-copy dw dw-calendar"></i>
									</span>
								</div>
							</div>
						</div>

					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary close_Get_Profit_Report_Excel_data" data-dismiss="modal">Cerrar</button>
						<button type="button" class="btn btn-primary Get_Profit_Report_Excel_data">Generar Reporte</button>
					</div>
				</div>
			</div>
		</div>



		<div class="modal fade loader1" id="loader1" data-bs-keyboard="false" data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
		  <div class="modal-dialog modal-lg mt-6 modal-dialog-centered" role="document">
		    <div class="modal-content border-0">
		      <div class="modal-body p-0 d-flex flex-column justify-content-center align-items-center" style="min-height: 300px;">
		        <div class="spinner"></div>
		        <p class="mt-3 text-dark text_send_email"></p>
		      </div>
		    </div>
		  </div>
		</div>

		<div class="modal fade" id="modalHistoryMovement" tabindex="-1" role="dialog" aria-labelledby="modalResolutionLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header bg-primary text-white">
						<h5 class="modal-title" id="modalResolutionLabel" style="color: white;">Historial de Movimiento de Inventario</h5>
						<button type="button" class="close text-white" data-dismiss="modal" aria-label="Cerrar">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form id="form_resolution">
							<div class="form-group">
								<label for="selectBranch">Sucursal</label>
								<select class="form-control" id="selectBranch" name="branch_id">
									<option value="">Seleccione una sucursal</option>
									{% for i in request.session.list_branch %}
										<option value="{{ i.id }}">{{ i.business_name }}</option>
									{% endfor %}
								</select>
							</div>

							<div class="form-group">
								<label for="start_date">Fecha de inicio</label>
								<input type="date" class="form-control" id="start_date" name="start_date">
							</div>

							<div class="form-group">
								<label for="end_date">Fecha de fin</label>
								<input type="date" class="form-control" id="end_date" name="end_date">
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
						<button type="button" class="btn btn-primary" id="historymovement">Descargar</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="generate_closure_report_by_date" tabindex="-1" role="dialog" aria-labelledby="modalResolutionLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header bg-primary text-white">
						<h5 class="modal-title" id="modalResolutionLabel" style="color: white;">Cierre de Caja por fecha</h5>
						<button type="button" class="close text-white" data-dismiss="modal" aria-label="Cerrar">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<form id="form_resolution">
							<div class="form-group">
								<label for="selectBranchs">Sucursal</label>
								<select class="form-control" id="selectBranchs" name="branch_id">
									<option value="">Seleccione una sucursal</option>
									{% for i in request.session.list_branch %}
										<option value="{{ i.id }}">{{ i.business_name }}</option>
									{% endfor %}
								</select>
							</div>

							<div class="form-group">
								<label for="selectEmployee">Empleado</label>
								<select class="form-control" id="selectEmployee" name="employee_id">
									<option value="">Seleccione un empleado</option>
									{% for i in request.session.list_employee %}
										<option value="{{ i.id }}">{{ i.first_name|title }} {{ i.surname|title }}</option>
									{% endfor %}
								</select>
							</div>

							<div class="form-group">
								<label for="start_date">Fecha de inicio</label>
								<input type="date" class="form-control" id="start_dates" name="start_date">
							</div>

							<div class="form-group">
								<label for="end_date">Fecha de fin</label>
								<input type="date" class="form-control" id="end_dates" name="end_date">
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
						<button type="button" class="btn btn-primary" id="Generate_Closure_Report_By_Date">Consultar</button>
					</div>
				</div>
			</div>
		</div>


		<!-- Modal Preloader -->
		<div class="modal fade" id="preloaderModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
		  <div class="modal-dialog modal-dialog-centered" role="document">
		    <div class="modal-content text-center">
		      <div class="modal-body">
		        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
		          <span class="sr-only">Cargando...</span>
		        </div>
		        <h5 class="mb-0 message_modal"></h5>
		        <p class="text-muted mb-0">Por favor espera un momento</p>
		      </div>
		    </div>
		  </div>
		</div>




	<!-- END MODALS -->

	<script src="{% static 'vendors/scripts/core.js' %}"></script>
	<script src="{% static 'vendors/scripts/script.min.js' %}"></script>
	<script src="{% static 'vendors/scripts/process.js' %}"></script>
	<script src="{% static 'vendors/scripts/layout-settings.js' %}"></script>
	<script src="{% static 'src/plugins/apexcharts/apexcharts.min.js' %}"></script>
	<script src="{% static 'src/plugins/cropperjs/dist/cropper.js' %}"></script>
	<script src="{% static 'evangeli/information.js' %}"></script>
	<script>

		window.addEventListener('DOMContentLoaded', function () {
			var image = document.getElementById('image');
			var cropBoxData;
			var canvasData;
			var cropper;

			$('#modal').on('shown.bs.modal', function () {
				cropper = new Cropper(image, {
					autoCropArea: 0.5,
					dragMode: 'move',
					aspectRatio: 3 / 3,
					restore: false,
					guides: false,
					center: false,
					highlight: false,
					cropBoxMovable: false,
					cropBoxResizable: false,
					toggleDragModeOnDblclick: false,
					ready: function () {
						cropper.setCropBoxData(cropBoxData).setCanvasData(canvasData);
					}
				});
			}).on('hidden.bs.modal', function () {
				cropBoxData = cropper.getCropBoxData();
				canvasData = cropper.getCanvasData();
				cropper.destroy();
			});
		});
	</script>
	<script src="{% static 'src/plugins/dropzone/src/dropzone.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/jquery.dataTables.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/dataTables.bootstrap4.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/dataTables.responsive.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/responsive.bootstrap4.min.js' %}"></script>

	<!-- buttons for Export datatable -->
	<script src="{% static 'src/plugins/datatables/js/dataTables.buttons.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/buttons.bootstrap4.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/buttons.print.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/buttons.html5.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/buttons.flash.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/pdfmake.min.js' %}"></script>
	<script src="{% static 'src/plugins/datatables/js/vfs_fonts.js' %}"></script>
	<script src="{% static 'vendors/scripts/datatable-setting.js' %}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		const numberWords = {
		    "un": 1,
		    "uno": 1,
		    "dos": 2,
		    "tres": 3,
		    "cuatro": 4,
		    "cinco": 5,
		    "seis": 6,
		    "siete": 7,
		    "ocho": 8,
		    "nueve": 9,
		    "diez": 10,
		    "once": 11,
		    "doce": 12,
		    "trece": 13,
		    "catorce": 14,
		    "quince": 15,
		    "dieciséis": 16,
		    "diecisiete": 17,
		    "dieciocho": 18,
		    "diecinueve": 19,
		    "veinte": 20
		};
	</script>
	<script>

		// START VARIABLES
		
		let evangeli = "Evangeli"
		let calling = false
		let company_id = {{request.session.company_id|safe}}
		let get_customer_url = "{% url 'Get_Customer' %}"
		let list_customer_data = []
		let disableRefresh = false;

		// END VARIABLES

		url_static_files = "{% url 'service_worker_cache' %}"
		function Notification(icon, title, text, confirmButtonText){
			Swal.fire({
	            icon:icon,
	            title:title,
	            text:text,
	            confirmButtonText:confirmButtonText
	        });
		}

		function showPreloaderModal() {
		  $('#preloaderModal').modal('show');
		}
		
		function hidePreloaderModal() {
		  $('#preloaderModal').modal('hide');
		}

		$(document).ready(function(){

			let maintenance = new WebSocket("wss://api.evansoft.co/ws/resolution/");

			maintenance.onopen = function () {
			    console.log("Conexión WebSocket establecida");
			    controlarMantenimiento();
			};

			maintenance.onmessage = function (event) {
			    try {
			        let data = JSON.parse(event.data);
			        console.log(data);
			        if (data.result) {
			            Notification(
			                data.icon,
			                data.title,
			                data.message,
			                data.button
			            );
			        }
			    } catch (error) {
			        console.error("Error al procesar mensaje WebSocket:", error);
			    }
			};

			maintenance.onerror = function (error) {
			    console.log("Error en WebSocket: ", error);
			};

			maintenance.onclose = function () {
			    console.log("Conexión WebSocket cerrada. Intentando reconectar...");
			    setTimeout(() => {
			        location.reload();
			    }, 3000);
			};

			function controlarMantenimiento() {
			    const ahora = Date.now();
			    const ultimaEjecucion = parseInt(localStorage.getItem("ultimo_mantenimiento"), 10);
			    const intervalo = 30 * 60 * 1000; // 30 minutos

			    if (isNaN(ultimaEjecucion) || (ahora - ultimaEjecucion >= intervalo)) {
			        enviarMantenimiento();
			    } else {
			        const restante = intervalo - (ahora - ultimaEjecucion);
			        console.log(`Esperando ${restante / 1000} segundos para el siguiente mantenimiento`);
			        setTimeout(() => {
			            enviarMantenimiento();
			        }, restante);
			    }
			}

			function enviarMantenimiento() {
			    if (maintenance.readyState === WebSocket.OPEN) {
			        maintenance.send(JSON.stringify({ action: "maintenance" }));
			        localStorage.setItem("ultimo_mantenimiento", Date.now());
			        console.log("✅ Mantenimiento enviado");
			        setTimeout(() => {
			            enviarMantenimiento();
			        }, 30 * 60 * 1000);
			    } else {
			        console.warn("❌ WebSocket no está listo para enviar mantenimiento");
			    }
			}

			$(".generate_closure_report_by_date").click(function(){
				$("#generate_closure_report_by_date").modal('show')
			})

			$("#Generate_Closure_Report_By_Date").click(function () {
				let branch_id = $("#selectBranchs").val();
				let employee_id = $("#selectEmployee").val();
				let start_date = $("#start_dates").val();
				let end_date = $("#end_dates").val();

				if (!branch_id) {
					Swal.fire({
						icon: 'warning',
						title: 'Sucursal requerida',
						text: 'Por favor, seleccione una sucursal antes de continuar.',
						confirmButtonText: 'OK'
					});
					return;
				}

				let data = {
					branch_id: branch_id,
					employee_id: employee_id || null,
					start_date: start_date || null,
					end_date: end_date || null
				};

				// Mensaje de advertencia si no hay fechas o empleado seleccionado
				if (!employee_id || !start_date || !end_date) {
					let mensaje = "Está realizando la consulta solo por sucursal.";
					if (!employee_id && (start_date && end_date)) {
						mensaje = "Está realizando la consulta sin seleccionar un empleado.";
					}
					if ((employee_id && (!start_date || !end_date))) {
						mensaje = "Está realizando la consulta sin definir fechas.";
					}
					if (!employee_id && (!start_date || !end_date)) {
						mensaje = "Está realizando la consulta solo por sucursal, sin empleado ni fechas.";
					}

					Swal.fire({
						icon: 'question',
						title: '¿Desea continuar?',
						text: mensaje,
						showCancelButton: true,
						confirmButtonText: 'Sí, continuar',
						cancelButtonText: 'Cancelar'
					}).then((result) => {
						if (result.isConfirmed) {
							solicitarReporte(data);
						}
					});
				} else {
					solicitarReporte(data);
				}

				function solicitarReporte(data) {
					$(".message_modal").text("Cargando información...")
					showPreloaderModal();
					$.ajax({
						url: '{% url "Generate_Closure_Report_By_Date" %}',
						method: "POST",
						data: JSON.stringify(data),
						contentType: 'application/json',
						headers: {
							"X-CSRFToken": "{{ csrf_token }}"
						},
						success: function (response) {
							
							console.log("Respuesta:", response);
							$("#generate_closure_report_by_date").modal('hide');

							// Abrir el reporte en ventana centrada
							let screenWidth = window.screen.width;
							let screenHeight = window.screen.height;
							let windowWidth = 800;
							let windowHeight = 600;
							let leftPosition = (screenWidth - windowWidth) / 2;
							let topPosition = (screenHeight - windowHeight) / 2;

							let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=${windowWidth},height=${windowHeight},left=${leftPosition},top=${topPosition}`;
							window.open("https://evansoft.co/invoice/Generate_Closure_Report_By_Dates/", "Cierre de Caja", params);
							setTimeout(() => {
								hidePreloaderModal();
							}, 500);
						},
						error: function (xhr, status, error) {
							hidePreloaderModal();
							console.error("Error:", error);
							modalLoader.hide();
							Swal.fire({
								icon: 'error',
								title: 'Error',
								text: 'Ocurrió un error al solicitar el reporte.',
								confirmButtonText: 'OK'
							});
						}
					});
				}
			});



			$(".history_mov").click(function(){
				$("#modalHistoryMovement").modal("show");
			})

			$("#historymovement").click(function() {
				let branch_id = $("#selectBranch").val();
				let start_date = $("#start_date").val();
				let end_date = $("#end_date").val();

				if (branch_id !== "") {
					$(".text_send_email").text('Espere mientras preparamos el documento.');
					var modalLoader = new bootstrap.Modal(document.getElementById('loader1'), {
						keyboard: false,
						backdrop: 'static'
					});
					modalLoader.show();

					const data = {
						branch_id: branch_id,
						start_date: start_date || null,
						end_date: end_date || null
					};

					$("#modalHistoryMovement").modal("hide");

					$.ajax({
						url: '{% url "Generate_Movement_History_Report" %}',
						method: "POST", 
						data: JSON.stringify(data),
						contentType: 'application/json',
						headers: {
							"X-CSRFToken": "{{ csrf_token }}"
						},
						success: function(response) {
							console.log("Respuesta:", response);
							modalLoader.hide();
							if (response.result) {
								const link = document.createElement("a");
								link.href = response.path_report;
								link.download = "movimientos_inventario.xlsx";
								document.body.appendChild(link);
								link.click();
								document.body.removeChild(link);
							} else {
								modalLoader.hide();
								Swal.fire({
									icon: 'warning',
									title: 'Atención',
									text: response.message,
									confirmButtonText: 'OK'
								}).then((result) => {
									if (result.isConfirmed) {
										location.reload(true);
									}
								});
							}
						},
						error: function(xhr, status, error) {
							console.error("Error:", error);
							modalLoader.hide();
							Swal.fire({
								icon: 'error',
								title: 'Error',
								text: 'Ocurrió un error al solicitar la información.',
								confirmButtonText: 'OK'
							}).then((result) => {
								if (result.isConfirmed) {
									location.reload(true);
								}
							});
							
						}
					});
				} else {
					Swal.fire({
						icon: 'error',
						title: 'Error',
						text: 'Debe seleccionar una sucursal.',
						confirmButtonText: 'OK'
					});
				}
			});


			// $("#modalResolution").modal("hide");




			$(".Get_Profit_Report_Excel").click(function(){
				console.log("Ejecutando")
				$(".text_send_email").text('Espere mientras preparamos el documento.');
				var modalLoader = new bootstrap.Modal(document.getElementById('loader1'), {
				  keyboard: false,
				  backdrop: 'static'
				});
				modalLoader.show();
				$.ajax({
					url : "{% url 'Get_Profit_Report' %}",
					success: function(response){
						console.log(response)
						if (response.path_report) {
							const link = document.createElement("a");
							link.href = response.path_report;
							link.download = "ventas_reporte.xlsx"; // Nombre opcional
							document.body.appendChild(link);
							link.click();
							document.body.removeChild(link);
						} else {
							alert("No se pudo generar el reporte.");
						}
						modalLoader.hide()
					}
				})
			})


			$(".export_sales_report").click(function(){
				$(".export_sales_report_modal").click()
			})

			$(".export_data").click(function(){
				$.ajax({
					url : "{% url 'Export_Sales_Report' %}",
					data:{
					    "branch_id": {{request.session.branch_id|safe}},
					    "start_date":$("#fecha-inicial").val(),
					    "end_date":$("#fecha-final").val()
					},
					success: function(response){
						console.log(response)
						if (response.path_report) {
							const link = document.createElement("a");
							link.href = response.path_report;
							link.download = "ventas_reporte.xlsx"; // Nombre opcional
							document.body.appendChild(link);
							link.click();
							document.body.removeChild(link);
							$(".close_export_data").click()
						} else {
							alert("No se pudo generar el reporte.");
						}
					}
				})
			})


			$(".generate_journal_report").click(function(){
				$(".generate_journal_report_modal").click()
			})

			$(".generate_journal_report_data").click(function(){
				$.ajax({
					url : "{% url 'Generate_Journal_Report' %}",
					data:{
					    "branch_id": {{request.session.branch_id|safe}},
					    "start_date":$("#fecha-inicial_journal").val(),
					    "state": "confirmado",
					    "end_date":$("#fecha-final_journal").val()
					},
					success: function(response){
						console.log(response)
						if (response.path_report) {
							const link = document.createElement("a");
							link.href = response.path_report;
							link.download = "ventas_reporte.xlsx"; // Nombre opcional
							document.body.appendChild(link);
							link.click();
							document.body.removeChild(link);
							$(".close_generate_journal_report_data").click()
						} else {
							alert("No se pudo generar el reporte.");
						}
					}
				})
			})



			$(".close_box").click(function () {
				$.ajax({
					url: "{% url 'Close_Box_Days' %}",
					success: function(response){
						console.log(response)
						if(response.result){
							if(response.print_close_box){
								abrirVentanaImpresion()
							}
							else{
								 window.location.href = "{% url 'Logins' %}";
							}
						}
						else{
							 Swal.fire({
								icon: 'error',
								title: 'Error',
								text: 'Ocurrió un error al cerrar la caja.',
								confirmButtonText: 'OK'
							}).then((result) => {
								if (result.isConfirmed) {
									location.reload(true);
								}
							});
						}
					}
				})
			})

			function abrirVentanaImpresion() {
			    let screenWidth = window.screen.width;
			    let screenHeight = window.screen.height;
			    let windowWidth = 800;
			    let windowHeight = 600;
			    let leftPosition = (screenWidth - windowWidth) / 2;
			    let topPosition = (screenHeight - windowHeight) / 2;

			    let params = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=${windowWidth},height=${windowHeight},left=${leftPosition},top=${topPosition}`;

			    let printWindow = window.open("https://evansoft.co/invoice/Generate_Closure_Report/", "Cierre de Caja", params);

			    let checkClosed = setInterval(function () {
			        if (printWindow.closed) {
			            clearInterval(checkClosed);
			            location.href = "{% url 'Logins' %}";
			        }
			    }, 500);

			    printWindow.onload = function () {
			        printWindow.document.body.style.zoom = "100%";
			        printWindow.print();
			        printWindow.onafterprint = function () {
			            printWindow.close();
			        };
			    };
			}


			
			$(document).on('keydown', function(event) {
			    if (event.key === 'F2') {
			        event.preventDefault();
			        location.href = "{% url 'Create_Invoice' 1 %}"		        
			    }
			    else if (event.key === 'F3') {
			        event.preventDefault();
			        location.href = "{% url 'List_Invoice' 1 %}"
			    }
			    if (disableRefresh) {
			        if (
			            event.key === "F5" || event.keyCode === 116 ||   // F5
			            (event.ctrlKey && (event.key === "r" || event.keyCode === 82)) // Ctrl+R
			        ) {
			            event.preventDefault();
			            console.log("🚫 Refresh bloqueado mientras se procesa la factura");
			            return false;
			        }
			    }
			});

		})
	</script>
	{% block script %}{% endblock %}
	<script src="{% static 'evangeli/commands.js' %}"></script>
	<script src="{% static 'evangeli/ai.js' %}"></script>
	<script src="{% static 'evangeli/evangeli.js' %}"></script>
	
	<script src="{% static 'evangeli/voices.js' %}"></script>
	
	
</body>
</body>
</html>
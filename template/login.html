{% load static %}
<!DOCTYPE html>
<html>
<head>
	<!-- Basic Page Info -->
	<meta charset="utf-8">
	<title>DeskApp</title>

	<!-- Site favicon -->
	<link rel="apple-touch-icon" sizes="180x180" href="{% static 'vendors/images/apple-touch-icon.png' %}">
	<link rel="icon" type="image/png" sizes="32x32" href="{% static 'vendors/images/favicon-32x32.png' %}">
	<link rel="icon" type="image/png" sizes="16x16" href="{% static 'vendors/images/favicon-16x16.png' %}">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/core.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/icon-font.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'src/plugins/sweetalert2/sweetalert2.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'vendors/styles/style.css' %}">
	<link rel="manifest" href="{% static 'manifest.json' %}">
	<style>
		input[type=number]::-webkit-inner-spin-button, 
		input[type=number]::-webkit-outer-spin-button { 
		  -webkit-appearance: none; 
		  margin: 0; 
		}
		input[type=number] { -moz-appearance:textfield; }

		/* Spinner centrado */
		.spinner {
			width: 80px;
			height: 80px;
			border: 8px solid rgba(0, 0, 0, 0.1); /* Bordes suaves */
			border-top-color: #3498db; /* Color principal del borde superior */
			border-radius: 50%; /* Hace que el div sea circular */
			animation: spin 1s linear infinite; /* Animación de giro infinita */
			overflow: hidden;
		}

		/* Animación de giro */
		@keyframes spin {
			0% {
			  transform: rotate(0deg);
			}
			100% {
			  transform: rotate(360deg);
			}
		}

		/* Estilos adicionales */
		.modal-body p {
			font-size: 18px;
			color: #333;
			overflow: hidden;
		}
	</style>
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-119386393-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-119386393-1');
	</script>
</head>
<body class="login-page">

	<div class="modal fade" id="create_rut" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered">
	        <div class="modal-content">
	            <div class="login-box bg-white box-shadow border-radius-10">
	                <div class="login-title">
	                    <h2 class="text-center text-primary">Crea tu cuenta gratis. Solo debes de subir la camara de comercio de tu empresa</h2>
	                </div>

	                <div class="row">
	                    <div class="col-sm-12">
	                        <div class="input-group mb-3">
	                            <input type="file" id="fileInput" class="form-control-file form-control height-auto">
	                        </div>
	                    </div>
	                    <div class="col-sm-12">
	                        <button id="uploadButton" class="btn btn-primary btn-lg btn-block">Subir Archivo</button>
	                    </div>
	                </div>
	                <div class="col-sm-12 mt-3">
	                    <div id="uploadMessage" class="alert d-none"></div>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>


	<div class="login-header box-shadow">
		<div class="container-fluid d-flex justify-content-between align-items-center">
			<div class="brand-logo">
				<a href="login.html">
					<img src="{% static 'vendors/images/deskapp-logo.svg' %}" alt="">
				</a>
			</div>
			<div class="login-menu">
				<ul>
					<li><a href="javascript:void(0);" class="register">Empezar Gratis</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="login-wrap d-flex align-items-center flex-wrap justify-content-center">
		<div class="container">
			<div class="row align-items-center">
				<div class="col-md-6 col-lg-7">
					<img src="{% static 'vendors/images/login-page-img.png' %}" alt="">
				</div>
				<div class="col-md-6 col-lg-5">
					<div class="login-box bg-white box-shadow border-radius-10">
						<div class="login-title">
							<h2 class="text-center text-primary">Iniciar sesión en Evansoft</h2>
						</div>
						<form class="form_data">
							<div class="input-group custom">
								<input type="number" name="documentI" class="form-control form-control-lg" value="{% if nit %}{{nit}}{% endif %}" autofocus placeholder="Company document">
								<div class="input-group-append custom">
									<span class="input-group-text"><i class="icon-copy dw dw-factory"></i></span>
								</div>
							</div>
							<div class="input-group custom">
								<input type="text" name="user" class="form-control form-control-lg" value="{% if user %}{{user}}{% endif %}" placeholder="User name">
								<div class="input-group-append custom">
									<span class="input-group-text"><i class="icon-copy dw dw-user1"></i></span>
								</div>
							</div>
							<div class="input-group custom">
								<input type="password" name="psswd" class="form-control form-control-lg psswd" value="{% if psswd %}{{psswd}}{% endif %}" placeholder="**********">
								<div class="input-group-append custom">
									<span class="input-group-text"><i class="dw dw-padlock1"></i></span>
								</div>
							</div>
							<div class="row pb-30">
								<div class="col-6">
									<div class="custom-control custom-checkbox">
										<input type="checkbox" class="custom-control-input" id="customCheck1">
										<label class="custom-control-label remember_me" for="customCheck1">Recuerdame</label>
									</div>
								</div>
								<div class="col-6">
								</div>
							</div>
							<div class="row">
								<div class="col-sm-12">
									<div class="input-group mb-0">
										<a class="btn btn-primary btn-lg btn-block sing_in" href="javascript:void(0);">Sign In</a>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal para actualizar resolución -->
	<div class="modal fade" id="modalRegister" tabindex="-1" role="dialog" aria-labelledby="modalResolutionLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title" id="modalResolutionLabel text-white" style="color: white !important;">Registro para licencia gratuita</h5>
					<button type="button" class="close text-white" data-dismiss="modal" aria-label="Cerrar">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<form id="form_resolution">
						<div class="form-group">
							<label for="valuePrefix">Correo Electrónico</label>
							<input type="email" class="form-control" id="email" name="email" placeholder="EJ: email@email.com">
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
					<button type="button" class="btn btn-primary" id="registerAccountFree">Registrarse</button>
				</div>
			</div>
		</div>
	</div>


	<!-- Modal Preloader -->
	<div class="modal fade" id="preloaderModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static" data-keyboard="false">
	  <div class="modal-dialog modal-dialog-centered" role="document">
	    <div class="modal-content text-center">
	      <div class="modal-body">
	        <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
	          <span class="sr-only">Cargando...</span>
	        </div>
	        <h5 class="mb-0 message_modal"></h5>
	        <p class="text-muted mb-0">Por favor espera un momento</p>
	      </div>
	    </div>
	  </div>
	</div>


	<!-- js -->
	<script src="https://code.jquery.com/jquery-3.7.1.slim.js" integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
	<script src="{% static 'vendors/scripts/core.js' %}"></script>
	<script src="{% static 'vendors/scripts/script.min.js' %}"></script>
	<script src="{% static 'vendors/scripts/process.js' %}"></script>
	<script src="{% static 'vendors/scripts/layout-settings.js' %}"></script>
	<!-- add sweet alert js & css in footer -->
	<script src="{% static 'src/plugins/sweetalert2/sweetalert2.all.js' %}"></script>
	<script src="{% static 'src/plugins/sweetalert2/sweet-alert.init.js' %}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script>
		$(document).ready(function(){

			if ('serviceWorker' in navigator) {
			  navigator.serviceWorker.register("{% static 'service-worker.js' %}")
			    .then(reg => console.log('Service Worker registrado', reg))
			    .catch(err => console.log('Error al registrar Service Worker', err));
			}

			if (localStorage.getItem('remember_me') === 'true') {
		        $('input[name="documentI"]').val(localStorage.getItem('documentI'));
		        $('input[name="user"]').val(localStorage.getItem('user'));
		        $('#customCheck1').prop('checked', true);
		        $(".psswd").focus()
		    }

		    // Al hacer clic en recordar
		    $('#customCheck1').on('change', function () {
		        if ($(this).is(':checked')) {
		            const documentI = $('input[name="documentI"]').val();
		            const user = $('input[name="user"]').val();

		            // Guardar en localStorage
		            localStorage.setItem('remember_me', 'true');
		            localStorage.setItem('documentI', documentI);
		            localStorage.setItem('user', user);
		        } else {
		            // Eliminar datos guardados
		            localStorage.removeItem('remember_me');
		            localStorage.removeItem('documentI');
		            localStorage.removeItem('user');
		        }
		    });


			$(".psswd").keyup(function(e){
				var code = e.key; 
				if(code==="Enter"){
					$.ajax({
						data: $(".form_data").serialize(),
						success: function(e){
							e = JSON.parse(e)
							console.log(e)
							if(e.result){
								location.href = "{% url 'Index' %}"
							}else{
								Swal.fire({
						            icon:"error",
						            title:"Oops... Algo salio mal",
						            text:e.message,
						            confirmButtonText:"ok"
						        });
							}
						}
					})
				}
			})

			$(".register").click(function(){
				$("#modalRegister").modal('show')
			})

			function getCookie(name) {
			    let cookieValue = null;
			    if (document.cookie && document.cookie !== '') {
			        const cookies = document.cookie.split(';');
			        for (let i = 0; i < cookies.length; i++) {
			            const cookie = cookies[i].trim();
			            // Busca la cookie con el nombre correcto
			            if (cookie.substring(0, name.length + 1) === (name + '=')) {
			                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
			                break;
			            }
			        }
			    }
			    return cookieValue;
			}

			function validarEmail(email) {
			    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			    return re.test(email);
			}


			$("#registerAccountFree").click(function(){

				const email = $("#email").val().trim();
				let modal = true
				$("#modalRegister").modal('hide')
				$(".message_modal").text('Espere mientras creamos tu cuenta gratuita.');
				var modalLoader = new bootstrap.Modal(document.getElementById('preloaderModal'), {
				  keyboard: false,
				  backdrop: 'static'
				});
				if(modal){
					modalLoader.show();
				}
			    let data = {
			        email: $("#email").val()
			    };

			    $.ajax({
			        url: "{% url 'Create_Company' %}",
			        type: "POST",
			        data: JSON.stringify(data),
			        contentType: "application/json",
			        headers: { "X-CSRFToken": getCookie("csrftoken")},
			        success: function(response){
			            console.log(response);
			            if(response.result){
			            	Swal.fire({
					            icon:"success",
					            title:"Cuenta creada exitosamente",
					            text:response.message+". Por favor revise su correo electrónico para obtener las credenciales de acceso",
					            confirmButtonText:"ok"
					        }).then((result) => {
						      if (result.isConfirmed) {
						        if(modal){
									modalLoader.hide()
								}
						      }
						    })
					        
			            }else{
			            	Swal.fire({
					            icon:"error",
					            title:"Oops... Algo salio mal",
					            text:response.message,
					            confirmButtonText:"ok"
					        }).then((result) => {
						      if (result.isConfirmed) {
						      	if(modal){
									modalLoader.hide()
									$("#modalRegister").modal('show')
								}
						      }
						    })
			            }
			            
			        },
			        error: function(xhr, status, error){
			            console.error("Error:", error);
			        }
			    });
			});


			$('.sing_in').click(function(e){
				e.preventDefault()
				if ($('#customCheck1').is(':checked')) {
		            localStorage.setItem('documentI', $('input[name="documentI"]').val());
		            localStorage.setItem('user', $('input[name="user"]').val());
		        }
				$.ajax({
					data: $(".form_data").serialize(),
					success: function(e){
						e = JSON.parse(e)
						console.log(e)
						if(e.result){
							location.href = "{% url 'Index' %}"
						}
						else{
							Swal.fire({
					            icon:"error",
					            title:"Oops... Algo salio mal",
					            text:e.message,
					            confirmButtonText:"ok"
					        });
						}
					}
				})
			})
		})
	</script>
</body>
</html>
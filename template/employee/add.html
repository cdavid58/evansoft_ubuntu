{% extends '../base.html' %}
{% block content %}
<style>
	/* Resalta el label si el campo est√° vac√≠o */
	.form-group label {
	    font-weight: 600;
	    transition: color 0.3s ease-in-out;
	}

	.form-group input:focus {
	    border-color: #007bff !important;
	    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
	}

	/* Campo obligatorio vac√≠o = borde rojo */
	.form-group .required:invalid {
	    border-color: red !important;
	}

	/* Cambia el color del label si el campo est√° vac√≠o */
	.form-group .required:invalid + label {
	    color: red;
	}

	.error-message {
	    display: none;
	    font-size: 0.85rem;
	    margin-top: 5px;
	}

	.is-invalid {
	    border-color: red !important;
	}

	.is-invalid + .error-message {
	    display: block;
	}


</style>


<div class="row mb-2">
	<div class="col-md-6 col-sm-12">
		<div class="title">
			<h4>üöÄ Vamos a crear un empleado!</h4>
		</div>
	</div>
	<div class="col-md-6 col-sm-12 text-right">
		<a class="btn btn-primary create_lient" href="{% url 'List_Employee' %}" role="button">Lista de empleados</a>
	</div>
</div>

<form class="form_data">
	<div class="row">
	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="identification_number">Documento de Identificaci√≥n</label>
	            <input type="number" id="identification_number" name="identification_number" class="form-control required">
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="first_name">Primer Nombre</label>
	            <input type="text" id="first_name" name="first_name" class="form-control" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="name">Segundo Nombre</label>
	            <input type="text" id="name" name="middle_name" class="form-control required" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="name">Primer Apellido</label>
	            <input type="text" id="name" name="surname" class="form-control required" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="name">Segundo Apellido</label>
	            <input type="text" id="name" name="second_surname" class="form-control required" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="phone">Tel√©fono</label>
	            <input type="tel" id="phone" name="phone" class="form-control required" 
	                pattern="^\d{7,10}$" maxlength="10" minlength="7">
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-3 col-sm-12">
	        <div class="form-group">
	            <label for="address">Direcci√≥n</label>
	            <input type="text" id="address" name="address" class="form-control required" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>
	    <div class="col-md-3 col-sm-12">
	        <div class="form-group">
	            <label for="email">Correo Electronico</label>
	            <input type="text" id="email" name="email" class="form-control required" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>
	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="email">Salario</label>
	            <input type="text" id="email" name="salary" class="form-control required" >
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>
	    <div class="col-md-3 col-12">
		    <div class="form-group">
		        <label for="payroll_type_document_identification">Tipo de Documento</label>
		        <select id="payroll_type_document_identification" name="payroll_type_document_identification_id" class="custom-select required">
		            {% for i in type_document_identification %}
		            	<option value="{{i.code}}">{{i.name}}</option>
		            {% endfor %}
		        </select>
		        <small class="error-message text-danger"></small>
		    </div>
		</div>
	</div>


	<div class="row">
		<div class="col-md-3 col-12">
		    <div class="form-group">
		        <label for="type_worker">Tipo de Trabajador</label>
		        <select id="type_worker" name="type_worker_id" class="custom-select required">
		            {% for i in type_worker %}
		            	<option value="{{i.code}}">{{i.name}}</option>
		            {% endfor %}
		        </select>
		        <small class="error-message text-danger"></small>
		    </div>
		</div>

		<div class="col-md-3 col-12">
		    <div class="form-group">
		        <label for="sub_type_worker">Sub-Tipo de Trabajador</label>
		        <select id="sub_type_worker" name="sub_type_worker_id" class="custom-select required">
		            {% for i in sub_type_worker %}
		            	<option value="{{i.code}}">{{i.name}}</option>
		            {% endfor %}
		        </select>
		        <small class="error-message text-danger"></small>
		    </div>
		</div>

		<div class="col-md-3 col-12">
		    <div class="form-group">
		        <label for="municipality">Municipio</label>
		        <select id="municipality" name="municipality_id" class="custom-select2 col-11 required">
		            {% for i in municipality %}
		                <option value="{{i.code}}">{{i.name}}</option>
		            {% endfor %}
		        </select>
		        <small class="error-message text-danger"></small>
		    </div>
		</div>		
		

		<div class="col-md-3 col-12">
		    <div class="form-group">
		        <label for="type_contract">Tipo de Contrato</label>
		        <select id="type_contract" name="type_contract_id" class="custom-select required">
		            {% for i in type_contract %}
		            	<option value="{{i.code}}">{{i.name}}</option>
		            {% endfor %}
		        </select>
		        <small class="error-message text-danger"></small>
		    </div>
		</div>
	</div>
	<div class="row">
		<div class="col-md-3 col-12">
		    <div class="form-group">
		        <label for="role">Tipo de ROL</label>
		        <select id="role" name="role" class="custom-select required">
		            {% for i in roles %}
		            	<option value="{{i.code}}">{{i.name}}</option>
		            {% endfor %}
		        </select>
		        <small class="error-message text-danger"></small>
		    </div>
		</div>
		
		<div class="col-md-3 col-12">
		    <div class="form-group">
				<label>Elije la sucursal</label>
				<select class="custom-select branchs" name="branch_id" style="width: 100%;">
					{% for i in list_branch %}
						<option value="{{i.id}}">{{i.business_name}}</option>
					{% endfor %}
				</select>
			</div>
		</div>

		<div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="user">Usuario</label>
	            <input type="text" id="user" name="user" class="form-control">
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>

	    <div class="col-md-2 col-sm-12">
	        <div class="form-group">
	            <label for="psswd">Contrase√±a</label>
	            <input type="text" id="psswd" name="psswd" class="form-control">
	            <small class="error-message text-danger"></small>
	        </div>
	    </div>
	</div>
	<div class="row">
		<div class="col-md-2 col-sm-12">
			<a class="btn btn-primary save_employee" href="javascript:void(0);" role="button">Crear Empleado</a>
		</div>
	</div>
</form>
							

{% endblock %}
{% block script %}

	<script>
		$(document).ready(function () {
		    $(".save_employee").click(function () {
		        let form = $(".form_data").serialize();
		        console.log("üìù Formulario serializado:", form);

		        $.ajax({
		            url: "{% url 'Save_Employee' %}",
		            type: "POST",
		            data: form, // ‚úÖ as√≠ como est√°
		            headers: {
		                "X-CSRFToken": "{{ csrf_token }}"
		            },
		            success: function (response) {
		                console.log("‚úÖ Respuesta del servidor:", response);
		                if(response.result){
		                	Notification("success", "Empleado creado", "El empleado fue creado correctamente.", "OK");
		                }else{
		                	Notification("error", "Oopss.. Algo sali√≥ mal.", response.message, "OK")
		                }
		            },
		            error: function (xhr, status, error) {
		                console.error("üö® Error en la petici√≥n:", status, error);
		            }
		        });
		    });
		});

	</script>
{% endblock %}